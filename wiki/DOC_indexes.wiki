#summary Определения индексов для обхода дерева веток.

= Определения индексов и прочей нечисти =

== Ветки и баки ==

Класс ветки - `TBranch` - включает в себя все основные
методы для обработки и отрисовки трубопровода, а также массив сегментов `Tube`.
Основной массив веток - `Branch[]`. Количество веток - BranchesNum. Таким образом, последняя ветка представлена в `Branch[BranchesNum-1]`.
Нулевой элемент массива - основная ветка.
Она отличается от дочерних тем, что всегда имеет два бака - входной 

`Branch[0].Tube[0]`, и выходной 

`Branch[BranchesNum-1].Tube[Branch[BranchesNum-1].ObjectsNum-1]`. 

Дочерние ветки имеют только один бак:

`Branch[].Tube[Branch[].ObjectsNum-1]`. 

Тип дочерней ветки (расходная или приемная) и, соответственно, ее бака записан в свойстве

`Branch[].FlowDirection`, которое может принимать значения `fdSupply` или `fdReceive`.






== Индексы и массивы для обхода дерева веток ==

*JointSegment* - свойство ветки - массив индексов сегментов с присоединенными ветками (т.н. Joint-сегментов). Нулевой элемент массива указывает на первый по счету joint-сегмент в средней части ветки, т.е.  между 1 и ObjectsNum-2. Массив перестраивается каждый раз при деформации каркаса. Хотя тут можно подумать и оптимизировать, но на данный момент это не приоритетно.

*JointBranch* - свойство сегмента - массив индексов дочерних веток, присоединенных к данному joint-сегменту. Для не-joint-сегментов этот массив пуст. Нулевой элемент массива указывает на первую по счету дочернюю ветку.

_Эти массивы необходимы для обхода дерева "сверху" - от базовой ветки к дочерним._

*ParentBranch* - свойство ветки - индекс родительской ветки. Для корневой (основной) ветки он равен "-1".

*ParentSegment* - свойство ветки - индекс сегмента в родительской ветке, куда присоединена данная ветка. Ссылается на элемент трубы, а не на JointSegment. Корректируется (для дочерних веток) в процедуре копирования свойств сегмента. Для корневой ветки ParentSegment также равен "-1". Для отслеживания изменений в каркасе, наверное, удобнее будет ссылаться через JointSegment, иначе придется пробегать по дочерним веткам при изменении числа сегментов. Тогда массив "соседних" или "братских" веток для любой дочерней определяется по элементам массива:

`Branch[ParentBranch].Tube[  Branch[ParentBranch].JointSegment[ParentSegment] ].JointBranch []`

При этом надо не забыть про изменение массива JointSegment при изменении числа сегментов.

_Эти индексы необходимы для построения массивов  JointSegment/JointBranch, обхода дерева "снизу", а также для отображения дерева в палитре веток._